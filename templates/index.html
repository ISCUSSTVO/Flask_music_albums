{% extends "base.html" %}
{% block content %}
<div class="container">
    <section class="home-section">
        <h2 class="section-title">–ê—Ä—Ç–∏—Å—Ç—ã</h2>
        <div class="artist-row">
            {% for artist in artists %}
            <a href="{{ url_for('main.artist_page', artist_id=artist.id) }}" class="artist-item">
                <div class="avatar-wrapper">
                    <img src="{{ url_for('static', filename='img/artists/' ~ artist.image_url) }}">
                </div>
                <span>{{ artist.name }}</span>
            </a>
            {% endfor %}
        </div>
    </section>

    <section class="home-section">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h2 class="section-title" style="margin: 0;">–ê–ª—å–±–æ–º—ã</h2>
        
        <form class="filter-bar" method="GET" action="/" style="display: flex; gap: 12px; align-items: center;">
            <select name="sort" onchange="this.form.submit()" style="padding: 8px 12px; border-radius: 6px; background: #2b3a4e; color: white; border: 1px solid #3d4d5f;">
                <option value="rating_desc" {% if request.args.get('sort') == 'rating_desc' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–ª—É—á—à–∏–µ)</option>
                <option value="rating_asc" {% if request.args.get('sort') == 'rating_asc' %}selected{% endif %}>–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É (—Ö—É–¥—à–∏–µ)</option>
                <option value="newest" {% if request.args.get('sort') == 'newest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ</option>
                <option value="oldest" {% if request.args.get('sort') == 'oldest' %}selected{% endif %}>–°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ</option>
                <option value="az" {% if request.args.get('sort') == 'az' %}selected{% endif %}>–ê ‚Äî –Ø</option>
            </select>

            <select name="genre" onchange="this.form.submit()" style="padding: 8px 12px; border-radius: 6px; background: #2b3a4e; color: white; border: 1px solid #3d4d5f;">
                <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
                {% for g in genres %}
                    <option value="{{ g }}" {% if request.args.get('genre') == g %}selected{% endif %}>{{ g }}</option>
                {% endfor %}
            </select>
            
            <a href="/" class="reset" style="background: #3d4d5f; color: white; padding: 8px 15px; border-radius: 6px; text-decoration: none; font-size: 0.9em;">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</a>
        </form>
    </div>

        <div class="grid">
            {% for album in albums %}
            <div class="card">
                {% if current_user.is_authenticated %}
                <form action="{{ url_for('media.delete_album', album_id=album.id) }}" method="POST" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–ª—å–±–æ–º?');">
                    <button type="submit" style="background: none; border: none; color: #ff4d4d; cursor: pointer; font-size: 0.8em; margin-top: 10px;">
                        üóë –£–¥–∞–ª–∏—Ç—å –∞–ª—å–±–æ–º
                    </button>
                </form>
                {% endif %}
                <a href="{{ url_for('main.album_page', album_id=album.id) }}">
                    <img src="{{ url_for('static', filename='img/covers/' ~ (album.cover_url if album.cover_url else 'default.jpeg')) }}" 
                        class="album-cover-mini" 
                        alt="{{ album.title }}";">
                    <h3>{{ album.title }}</h3>
                    <p class="artist-name">{{ album.author.name if album.author else "Unknown" }}</p>
                    <div class="rating">
                        {% set r = album.rating | int %}
                        {{ "‚òÖ" * r }}{{ "‚òÜ" * (5 - r) }}
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}